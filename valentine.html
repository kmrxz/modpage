<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Like Button</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background: #111;
  color: white;
  font-family: Arial, sans-serif;
}

.container {
  text-align: center;
}

button {
  background: none;
  border: none;
  font-size: 60px;
  cursor: pointer;
  transition: transform 0.2s ease;
}

button.liked {
  color: red;
}

button.animate {
  animation: pop 0.3s ease;
}

@keyframes pop {
  0% { transform: scale(1); }
  50% { transform: scale(1.3); }
  100% { transform: scale(1); }
}

#count {
  display: block;
  font-size: 24px;
  margin-top: 10px;
}
</style>
</head>

<body>

<div class="container">
  <button id="likeBtn">❤️</button>
  <span id="count">0</span>
</div>

<script>
const { createClient } = supabase;
const supabaseClient = createClient(
  "https://hoecmurfgjlgrckeeovc.supabase.co",
  "sb_publishable_v4q_a1uQZHNFbBkHkki0DA_qVnGBpxE"
);

const likeId = "main-post";
const likeBtn = document.getElementById("likeBtn");
const countSpan = document.getElementById("count");

async function loadLikes() {
  const { data } = await supabaseClient
    .from("likes")
    .select("count")
    .eq("id", likeId)
    .single();

  countSpan.innerText = data.count;

  if (localStorage.getItem("liked_" + likeId)) {
    likeBtn.classList.add("liked");
    likeBtn.disabled = true;
  }
}

async function like() {
  if (localStorage.getItem("liked_" + likeId)) return;

  likeBtn.classList.add("animate");

  await supabaseClient.rpc("increment_like", { row_id: likeId });

  localStorage.setItem("liked_" + likeId, "true");

  loadLikes();

  likeBtn.classList.add("liked");
  likeBtn.disabled = true;

  setTimeout(() => likeBtn.classList.remove("animate"), 300);
}

likeBtn.addEventListener("click", like);

loadLikes();
</script>

</body>
</html>